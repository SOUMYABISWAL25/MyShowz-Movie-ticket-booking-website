<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Registration - MyShowz</title>
    <link rel="stylesheet" type="text/css" href="assets/css/as-alert-message.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/style-starter.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            text-decoration: none;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .back-link:hover {
            color: #0066ff;
        }

        .register-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 400px;
            margin-top: 40px;
        }

        .register-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .shield-icon {
            width: 48px;
            height: 48px;
            background-color: #e8f0fe;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }

        .shield-icon svg {
            width: 24px;
            height: 24px;
            fill: #0066ff;
        }

        h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper svg {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            fill: #666;
        }

        input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            color: #333;
        }

        input:focus {
            outline: none;
            border-color: #0066ff;
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        input::placeholder {
            color: #999;
        }

        .info-text {
            color: #666;
            font-size: 12px;
            margin-top: 4px;
        }

        .register-button {
            width: 100%;
            padding: 12px;
            background: #0066ff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 8px;
        }

        .register-button:hover {
            background: #0052cc;
        }

        .login-link {
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            color: #666;
        }

        .login-link a {
            color: #0066ff;
            text-decoration: none;
            font-weight: 500;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            color: #dc3545;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .aws-info {
            text-align: center;
            margin-top: 16px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .aws-info svg {
            width: 16px;
            height: 16px;
            fill: #666;
        }
    </style>
</head>
<body>
    <a href="sign_in.html" class="back-link">
        ‚Üê Back to Login
    </a>

    <main class="register-container">
        <div class="register-header">
            <div class="shield-icon">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 4c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm0 14c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z"/>
                </svg>
            </div>
            <h1>Admin Registration</h1>
            <p class="subtitle">Create an admin account to access the dashboard</p>
        </div>

        <form id="registerForm">
            <div class="form-group">
                <label for="email">Email</label>
                <div class="input-wrapper">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                    <input 
                        type="email" 
                        id="email" 
                        placeholder="Enter your email"
                        required
                    >
                </div>
                <div class="error-message" id="emailError">Please enter a valid email address</div>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <div class="input-wrapper">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>
                    </svg>
                    <input 
                        type="password" 
                        id="password" 
                        placeholder="Create a password"
                        required
                    >
                </div>
                <p class="info-text">Must be at least 8 characters with uppercase, lowercase, and numbers</p>
                <div class="error-message" id="passwordError">Password must meet the requirements</div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <div class="input-wrapper">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>
                    </svg>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        placeholder="Confirm your password"
                        required
                    >
                </div>
                <div class="error-message" id="confirmPasswordError">Passwords do not match</div>
            </div>

            <button type="submit" class="register-button">Create Admin Account</button>

            <div class="login-link">
                Already have an account? <a href="sign_in.html">Login</a>
            </div>
        </form>

        <div class="aws-info">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            Secured with AWS Amplify Cognito
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/aws-amplify@6.0.0/dist/aws-amplify.min.js"></script>
    <script type="module">
        import { Amplify } from "aws-amplify";
        import { signUp, confirmSignUp } from "aws-amplify/auth";

        Amplify.configure({
            Auth: {
                Cognito: {
                    userPoolId: process.env.AMPLIFY_AUTH_USER_POOL_ID,
                    userPoolClientId: process.env.AMPLIFY_AUTH_USER_POOL_CLIENT_ID,
                    signUpVerificationMethod: "code"
                }
            }
        });

        const registerForm = document.getElementById("registerForm");
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const confirmPasswordInput = document.getElementById("confirmPassword");
        const emailError = document.getElementById("emailError");
        const passwordError = document.getElementById("passwordError");
        const confirmPasswordError = document.getElementById("confirmPasswordError");

        const validateEmail = (email) => {
            return /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email);
        };

        const validatePassword = (password) => {
            return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(password);
        };

        emailInput.addEventListener("input", () => {
            if (validateEmail(emailInput.value)) {
                emailError.style.display = "none";
            }
        });

        passwordInput.addEventListener("input", () => {
            if (validatePassword(passwordInput.value)) {
                passwordError.style.display = "none";
            }
        });

        confirmPasswordInput.addEventListener("input", () => {
            if (confirmPasswordInput.value === passwordInput.value) {
                confirmPasswordError.style.display = "none";
            }
        });

        registerForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const email = emailInput.value;
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            // Validate email
            if (!validateEmail(email)) {
                emailError.style.display = "block";
                return;
            }

            // Validate password
            if (!validatePassword(password)) {
                passwordError.style.display = "block";
                return;
            }

            // Validate password confirmation
            if (password !== confirmPassword) {
                confirmPasswordError.style.display = "block";
                return;
            }

            try {
                // Sign up with AWS Cognito
                const { isSignUpComplete, userId, nextStep } = await signUp({
                    username: email,
                    password: password,
                    options: {
                        userAttributes: {
                            email: email
                        }
                    }
                });

                // If verification is required
                if (nextStep.signUpStep === "CONFIRM_SIGN_UP") {
                    const verificationCode = prompt("Please enter the verification code sent to your email:");
                    if (verificationCode) {
                        await confirmSignUp({
                            username: email,
                            confirmationCode: verificationCode
                        });
                        alert("Registration successful! You can now login.");
                        window.location.href = "sign_in.html";
                    }
                } else {
                    alert("Registration successful! You can now login.");
                    window.location.href = "sign_in.html";
                }
            } catch (error) {
                if (error.name === "UsernameExistsException") {
                    emailError.textContent = "This email is already registered";
                    emailError.style.display = "block";
                } else {
                    alert(error.message);
                }
            }
        });
    </script>
</body>
</html>